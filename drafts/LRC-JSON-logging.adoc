---
layout: post
title: "Using LogRecordContext with JSON Logging in Open Liberty"
categories: blog
author_picture: https://avatars0.githubusercontent.com/u/31770221
author_github: https://github.com/Yushan-Lin
seo-title: Title - Using LogRecordContext with JSON Logging in Open Liberty
seo-description: Learn how to use Open Liberty's LogRecordContext to add additional extensions to your application logs
blog_description: "Learn how to use Open Liberty's LogRecordContext to add additional extensions to your application logs"
---
= Using LogRecordContext with JSON Logging in Open Liberty
Yushan Lin <https://github.com/Yushan-Lin>

# Logging in Liberty
When monitoring applications in Liberty servers, users can view their logs to determine what is happening in their application. However, with many incoming logs, users may want want to sort and filter their logs in a certain way to better understand what is occurring in their application.

In Liberty, you can configure your server to log in JSON format. You can send your logs to a log analysis solution that understands JSON such that it can consume the server's logs. When you want to analyze your server's application logs, being able to add extra fields to your JSON log records can be very useful.
As an example, most real-world applications handle handle traffic from multiple users.
If you want to check the requests made from a specific user, it would be useful to have an extra field to filter application logs by the user's ID. Without the user ID field, it makes it much more difficult to determine which requests are made by which user, especially if you are trying to diagnose issues occurring with a specific user.
Furthermore, it may be useful to have another field for session ID, so that you can analyze and filter application logs for a specific session. Thus, you can easily diagnose issues occurring with a specific session associated with the user. As shown, there are many use cases where extra fields in log records can be very useful.

But how do you add fields to log and trace records?

Liberty has a little-known API -- the LogRecordContext.  LogRecordContext provides the ability to add extra fields to your log and trace records in Open Liberty. LogRecordContext provides a similar ability to Log4j MDC (Mapped Diagnostic Context).

# Using LogRecordContext
When the Liberty server is logging in JSON format, application logs will include any fields specified in the LogRecordContext. To enable Liberty to log in JSON format, add the following to your bootstrap properties:
```
com.ibm.ws.logging.console.format=json
com.ibm.ws.logging.console.log.level=info
com.ibm.ws.logging.console.source=message,trace,accessLog,ffdc,audit
```
The following examples illustrate how extra fields can be added to your application's log/trace records.
To use LogRecordContext, import the class `com.ibm.websphere.logging.hpel.LogRecordContext`.

To add a string-valued extension (field) to your application logs, include the following to your application:
`LogRecordContext.addExtension("userName","bob");`

To add other extensions with boolean, float, int or long values, the extension name must include the suffixes` _bool`, `_float`, `_int`, `_long` so that the value will be formatted correctly in the JSON output:
```
LogRecordContext.addExtension("extensionName_bool","true");
LogRecordContext.addExtension("extensionName_int","112233");
LogRecordContext.addExtension("extensionName_float","1.2");
LogRecordContext.addExtension("extensionName_long","132");
```

After including the extensions all logs/trace made on the same thread will include the field extensions. Notice that only string-valued extensions have quotes around the JSON values:
```
Trace Statement:
logger.fine("Logging in Liberty");
```
```
Output:
{"type":"liberty_trace","host":"yushans-mbp-2.war.can.ibm.com","ibm_userDir":"\/Users\/yushan.lin@ibm.com\/Documents\/libertyGit\/open-liberty\/dev\/build.image\/wlp\/usr\/","ibm_serverName":"sampleServer","message":"Logging in Liberty","ibm_threadId":"00000047","ibm_datetime":"2019-11-19T13:15:53.254-0500","module":"com.ibm.sample.LoggingServiceJUL","loglevel":"FINE","ibm_sequence":"1574187353254_0000000000001","ext_extensionName_bool":true,"ext_extensionName_float":1.2,"ext_extensionName_int":112233,"ext_thread":"Default Executor-thread-21","ext_userName":"bob","ext_extensionName_long":132}
```

```
Log Statement:
logger.info("Logging with LogRecordContext");
```
```
Output:
{"type":"liberty_message","host":"yushans-mbp-2.war.can.ibm.com","ibm_userDir":"\/Users\/yushan.lin@ibm.com\/Documents\/libertyGit\/open-liberty\/dev\/build.image\/wlp\/usr\/","ibm_serverName":"sampleServer","message":"Logging with LogRecordContext","ibm_threadId":"0000003e","ibm_datetime":"2019-11-19T13:15:53.517-0500","module":"com.ibm.sample.LoggingServiceJUL","loglevel":"INFO","ibm_sequence":"1574187353517_0000000000029","ext_extensionName_bool":true,"ext_extensionName_float":1.2,"ext_extensionName_int":112233,"ext_thread":"Default Executor-thread-15","ext_userName":"bob","ext_extensionName_long":132}
```


If using ELK (ElasticSearch, Logstash, Kibana) stack to view logs, you can see the extension fields there as well. You may need to refresh the Kibana index so you can use the new fields in your visualizations:

image::/img/blog/blog-LRC-kibana.png[]


For more information about analyzing logs in ELK: https://www.ibm.com/support/knowledgecenter/en/SSEQTP_liberty/com.ibm.websphere.wlp.doc/ae/twlp_elk_stack.html.

Extensions can be removed using the following method:
`LogRecordContext.removeExtension(extensionName);`

Overall, the LogRecordContext provides the useful ability to add additional fields so they can organize, analyze, and filter their logs based on their desired field.